<?php
require_once '../util/pdoconn.php';
require_once '../vo/userVO.php';

class userDAO {
    
     private $connect;
     
     // DB연결
     public function userDAO(){
         
         $pdo = new PDOconn();
         $this->connect = $pdo->get_connetion();
     }
     
     
     // 영화 목록
     public function movieList() {
         
         try {
             
            $sql = $this->connect->prepare("SELECT nMovieSeq, sMovieTitle, sMovieStory
            , sMovieImage, dtOpeningDate, sMovieDirector
            FROM tMovieList
            ORDER BY dtOpeningDate DESC");
            
            $sql->execute();
            $voArray = array();           
            
            while($row = $sql->fetch()){
                // VO클래스에 담아서 보내기 위해 생성
                $vo = new MovieVO();
                
                $vo->setMovieSeq($row['nMovieSeq']);
                $vo->setMovieTitle($row['sMovieTitle']);
                $vo->setMovieDirector($row['sMovieDirector']);
                $vo->setMovieStory($row['sMovieStory']);
                $vo->setMovieImage($row['sMovieImage']);
                $vo->setOpeningDate($row['dtOpeningDate']);
                
                array_push($voArray, $vo);
            }
            
            return $voArray;
         }
         
         catch(PDOException $ex){
             throw $ex->getMessage();
         }
     }
     
     // 영화 입력
     public function movieInsert($movie_title, $movie_story, $movie_image, $movie_date, $movie_director, $movie_genre) {
     
         try {
             $sql = "INSERT INTO tMovieList(sMovieTitle, sMovieStory, sMovieImage, dtOpeningDate, sMovieDirector, sGenreID)
             VALUES('$movie_title', '$movie_story', '$movie_image'
             , '$movie_date', '$movie_director', '$movie_genre')";
             
             $this->connect->exec($sql);
             echo "<script>alert('영화가 성공적으로 등록되었습니다.');";
             echo "location.href='../../index.php';</script>";
         }
         catch(PDOException $ex) {
             echo "<script>alert('영화 등록에 실패했습니다.<br> 에러: ".$ex->getMessage()."')</script>";
         }
         
         echo "<script>location.href='../../index.php'</script>";
     
     }
     
     // 영화 삭제
     public function userDelete($movie_seq){
         
     }
     
     
     // 회원 정보
     public function userSearch($movie_seq) {

         
        
     }
     
     // 회원정보 수정
     public function userUpdate() {
         
         
         
     }
    
}